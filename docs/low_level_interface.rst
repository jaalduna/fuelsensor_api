Interfaz de bajo nivel
===================

La comunicación entre la api y el dispositivo fuelsensor ocurre mediante intercambio de paquetes de bytes. La api genera solicitudes para el dispositivo fuelSensor mediante un `paquete query`. El dispositivo fuelsensor procesa el paquete y responde con el `paquete response`. 


Paquete Query
-------------

El formato del `paquete query` es:

`cmd (2 bytes), params(4 bytes), CRC(2 bytes)`

`cmd` representa una instrucción de comando a ejecutar para el dispositivo fuelsensor

Lista de commandos (cmd)
^^^^^^^^^^^^^^^^^^^

+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| cmd id | cmd name                        | params                           | DESCRIPCIÓN                                                                                                                                          |
+========+=================================+==================================+======================================================================================================================================================+
| 1      | BK_TIMESERIES                   | ---                              | se guarda un spanshot de la series de tiempo obtenedias en la última medición                                                                        |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 2      | GET_NORM_ECHO                   | offset (uint16), length (uint16) | retorna la secuencia de tiempo del eco almacenada en el snapshot a partir de la muestra `offset` y de largo `length` números de muestras             |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 3      | GET_SDFT_ECHO                   | offset (uint16), length (uint16) | retorna la secuencia SDFT almacenada en el snapshot  a partir de la muestra `offset` y de largo `length` números de muestras                         |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 4      | RESET                           | ---                              | resetea la aplicación. El bootloader queda a la espera de una señal por 30 segundos. Si no se recibe nada, entonces se vuelve a cargar la aplicacion |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 5      | GET_HEIGHT                      | ---                              | solicita la altura cálculada en metros (float32)                                                                                                     |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 6      | GET_POS                         | ---                              | solitica la posición del eco  (float32)                                                                                                              |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 7      | GET_PARAM                       | PARAM_ID                         | solicita el valor del parámetro identificado por `PARAM ID`                                                                                          |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 8      | SET_PARAM                       | PARAM_ID, PARAM_VALUE            | actualiza el valor del parámetro identificado por `PARAM ID` con el valor `PARAM_VALUE`                                                              |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 9      | RESTORE_DEFAULT_PARAMS_TO_FLASH | ---                              | resetea parámetros por defecto en la flash. Utilizar esta función para tener parámetros conocidos en la flash como un punto de partida.              |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+
| 10     | BACKUP_PARAMS_TO_FLASH          | ---                              | guarda los parámetros actuales en la memoria flash. Utiliza esta función una vez se esté conforme con los parámetros escogidos.                      |
+--------+---------------------------------+----------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------+


Lista de parámetros
"""""""""""""""""""
PARAM_BASE_ADDRESS = 0x9D021000

+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| PARAM_ADDR | PARAM_ID | type           | nombre                   | descripción                                                                 |
+============+==========+================+==========================+=============================================================================+
| 0x9D021000 | 00       | unsigned short | data_vector_type         | descripción pendiente                                                       |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021004 | 04       | unsigned short | data_vector_offset       | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021008 | 08       | byte           | pga_gain                 | ganancia del pga. Toma valores de 0 a 7                                     |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021009 | 09       | byte           | num_pulses               | número de pulsos del eco enviado.                                           |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D02100A | 0A       | byte           | pulse_period             | período de los pulsos. Cada unidad equivale a 10ns.                         |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D02100B | 0B       | byte           | pulse_width              | ancho del pulso. Cada unidad equivale a 10ns.                               |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D02100C | 0C       | byte           | res_hv                   | valor de resistencia de ajuste de fuente de alto voltaje. Valor Fijo de 40. |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D02100D | 0D       | float32        | sdft_min_peak_value_th   | threshold minimo para que el peak de sdft sea considerado valido            |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021011 | 11       | unsigned short | sdft_k                   | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021013 | 13       | unsigned short | sdft_n                   | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021015 | 15       | unsigned short | sdft_i_min               | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021017 | 17       | byte           | sdft_min_eco_limit       | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021018 | 18       | byte           | sdft_max_eco_limit       | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021019 | 19       | float32        | sdft_var_norm            | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D02101D | 1D       | float32        | sdft_peak                | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021021 | 21       | unsigned short | sdft_sound_speed         | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021023 | 23       | unsigned short | sdft_sample_rate         | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021025 | 25       | unsigned short | sdft_n_smaples_one_valid | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+
| 0x9D021027 | 27       | unsigned short | skip_param               | pendiente                                                                   |
+------------+----------+----------------+--------------------------+-----------------------------------------------------------------------------+



